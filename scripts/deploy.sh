#!/bin/sh

set -e -v

if [ -n ${TRAVIS_SSH_SECRET} ]; then
    SSH_ID_ARG="-i ${HOME}/id_rsa"
    cat <<EOF | openssl enc -d -pass env:TRAVIS_SSH_SECRET -aes256 -a -out ~/id_rsa
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
hqKAukcr7CNCG5I8/hBsGQ==
EOF
    chmod 600 ~/id_rsa
fi

ssh -p 22036 ${SSH_ID_ARG} -oStrictHostKeyChecking=no build@benhabib.liqd.net deploy liqd_product master
